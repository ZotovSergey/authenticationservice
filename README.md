# Authentication service
## Описание
Сервис для хранения информации о пользователях.
Каждый зарегистрированный пользователь может авторизоваться по своим логину и паролю и просматривать и менять информацию о себе и только просматривать информацию о других пользователях.
Пользователи-администраторы могут создавать, изменять и удалять профили.
### Данные пользователей
Данные пользователей, доступные для просмотра:
* Логин
* Имя
* Фамилия
## Setup
Сервис поднимается вызовом функции main из cmd/app/main.go
## База данных (пакет /internal/database/myProfilesDB)
В сервисе используется кастомная in memory база данных с возможностью сохранения данных на диск и поднятии при запуске сервиса.
База данных поднимается при запуске сервиса: в глобальной переменной создается экземпляр базы данных, в который записываются данные из файла базы данных, сохраненного по пути, прописанному в конфиге /configs/dbConfig.json в переменной "databaseDumpPath". В случае, когда по этому пути нет файла, файл создается и в него записывается пользователь-администратор с параметрами по-умолчанию, которые записываются в конфиге /configs/dbConfig.json в переменной "defaultAdminProfile". По-умолчанию, это пользователь с логином "admin" и паролем "admin".
Для избежания потерь данных файл с базой данных переписывается после каждого изменения в памяти. 
База данных хранит:
* Данные о пользователях
* Пароли в зашифрованном виде
* Список администраторов
В база данных реализованы следующие функции:
* Выдача параметров пользователя
* Выдача логинов всех зарегистрированных профилей
* Выдача зашифрованного пароля профиля по логину
* Выдача таблицы логинов и паролей (для авторизаторов)
* Запись данных и пароля (в зашифрованном виде) нового пользователя (регистрация)
* Замена данных в профиле на новые
* Изменение пароля профиля
* Удаление профиля
* Добавление логина профиля в список админов
* Удаление логина профиля из списка админов
## Запросы
Для реализации роутера запросов используется фреймворк Fiber: https://github.com/gofiber/fiber
Порт сервиса читается из конфига configs/portConfig.json, из переменной "port" (по-умолчанию localhost:3000)
Каждый запрос защищен базовой аутентификацией (basic auth).
Реализованы следующие запросы:
* /profile [get] - запрос на вывод данных о профиле по логину, доступно всем пользователям (запрос не работает со страницы swagger из браузера, но работает через postman или insomnia)
* /logins [get] - запрос на вывод списка логинов всех профилей, доступно всем пользователям
* /profile [post] - запрос на регистрацию нового пользователя, доступно только администраторам
* /profile [patch] - запрос на редактирование данных профиля, доступно всем пользователям при редактировании своих профилей и доступно редактирование всех профилей администраторам
* /password [patch] - запрос на изменение пароля пользователя, доступно всем пользователям при редактировании своих профилей и доступно редактирование всех профилей администраторам
* /profile [delete] - запрос удаление профиля, доступно только администраторам, нельзя удалять свой профиль
* /admin [post] - запрос на добавление администратора, доступно только администраторам
* /admin [delete] - запрос на удаление профиля из списка администраторов администратора, доступно только администраторам, нельзя удалять из списка администраторов свой профиль
Подробнее запросы описаны в документации swagger
## Аутентификация
Для прохождения аутентификации необходимо ввести логин и пароль, которые всверяются со списками логинов-паролей в базе данных. Если аутентифицированный пользователь входит в список администраторов, он получает полный доступ к управлению базой данных, но не может удалить свой профиль и вывести его из списка администраторов, чтобы было невозможно оставить сервис без зарегистрированных пользователей и администраторов.
## Swagger
Для генерации документации swagger использовался модуль swaggo: https://github.com/swaggo/swag
Документация пишется в директорию docs.
Обновление документации происходит по команде swag init -g cmd/app/main.go, если установлен модуль swag.
Посмотреть страницу документации в браузере можно при поднятом сервисе по url /swagger/index.html.